<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Num - Arbitrary Bit-Length Base Converter</title>
    
    <!-- Favicon and Fonts -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48dGV4dCB4PSI1MCIgeT0iODUiIGZvbnQtc2l6ZT0iOTAiIHRleHQtYW5jaGyPSJtaWRkbGUiIGZpbGw9IiM4MDVBRDIiPs67PC90ZXh0Pjwvc3ZnPg==">
    <link rel="shortcut icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48dGV4dCB4PSI1MCIgeT0iODUiIGZvbnQtc2l6ZT0iOTAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM4MDVBRDIiPs67PC90ZXh0Pjwvc3ZnPg==">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">

    <style>
        :root {
            --calc-bg: #404040;
            --calc-bg-light: #505050;
            --calc-border: #1a1a1a;
            --shadow-color: rgba(0,0,0,0.4);
            --font-main: 'JetBrains Mono', monospace;
            --font-brand: 'Orbitron', sans-serif;
            --lcd-bg: #8a9a8f;
            --lcd-text: #2f3d33;
            --lcd-shadow: rgba(0,0,0,0.5);
            --key-bg: #3a3a3a;
            --key-bg-light: #4e4e4e;
            --key-shadow: #2a2a2a;
            --key-active-bg: #353535;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #333;
            background-image:
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: var(--font-main);
            color: #eee;
        }

        #calculator-body {
            width: 420px;
            padding: 20px;
            border-radius: 16px;
            background: linear-gradient(145deg, var(--calc-bg-light), var(--calc-bg));
            border: 1px solid #666;
            border-top: 1px solid #777;
            border-left: 1px solid #777;
            box-shadow:
                8px 8px 16px rgba(0,0,0,0.5),
                -8px -8px 16px rgba(255,255,255,0.05),
                inset 0 0 0 2px var(--calc-border);
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        #brand-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #ccc;
            padding: 0 5px;
        }

        #brand-header h1 {
            font-family: var(--font-brand);
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 2px;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.1), -1px -1px 0px rgba(0,0,0,0.5);
        }

        /* --- LCD Screen Styles --- */
        #lcd-screen {
            background-color: var(--lcd-bg);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #333;
            box-shadow: inset 2px 2px 4px var(--lcd-shadow), inset -2px -2px 4px rgba(255,255,255,0.1);
            background-image: linear-gradient(rgba(0,0,0,0.05) 50%, transparent 50%);
            background-size: 100% 4px;
            position: relative;
        }

        #lcd-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(circle, rgba(255,255,255,0.05) 20%, transparent 80%);
            opacity: 0.5;
            pointer-events: none; /* Allow clicks to pass through */
        }

        #main-display {
            display: grid; /* Use grid to align perfectly with items below */
            grid-template-columns: 40px 1fr 28px;
            align-items: center;
            padding: 8px 5px;
            margin-bottom: 10px;
            min-height: 50px;
        }

        .input-mode {
            font-weight: bold;
            color: var(--lcd-text);
            text-shadow: 1px 1px 0px rgba(255,255,255,0.1);
            font-size: 1rem;
            grid-column: 1 / 2;
        }

        #number-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            font-family: var(--font-main);
            font-size: 2.2rem;
            color: var(--lcd-text);
            text-align: right;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.1);
            grid-column: 2 / 3;
            width: 100%;
        }

        #number-input::placeholder {
            color: rgba(47, 61, 51, 0.4);
        }

        .representations {
            display: grid;
            grid-template-columns: 1fr;
            gap: 5px;
        }

        .repr-item {
            display: grid;
            grid-template-columns: 40px 1fr 28px;
            align-items: center;
            font-size: 0.85rem;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .repr-item.special-item {
            font-size: 0.8rem;
        }

        .repr-item label {
            font-weight: bold;
            color: var(--lcd-text);
            opacity: 0.8;
        }

        .repr-item .value {
            font-family: var(--font-main);
            word-break: break-all;
            color: var(--lcd-text);
            text-shadow: 1px 1px 0px rgba(255,255,255,0.1);
            letter-spacing: 0.5px;
            padding: 0 5px;
        }

        .repr-item .binary {
            letter-spacing: 1px;
            font-size: 0.8rem;
        }

        .copy-btn {
            background: rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.1);
            color: var(--lcd-text);
            border-radius: 50%;
            width: 22px;
            height: 22px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            line-height: 0;
            transition: background-color 0.2s;
        }

        .copy-btn:hover {
            background: rgba(0,0,0,0.15);
        }

        .copy-btn:active {
            transform: scale(0.95);
        }

        .copy-icon {
            width: 12px;
            height: 12px;
            stroke-width: 2.5;
        }

        .copy-success {
            background-color: #a2b9a7;
        }

        /* --- Keypad Styles --- */
        #keypad {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .keypad-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }

        .mode-btn, .op-btn {
            border: 1px solid rgba(0,0,0,0.5);
            border-top-color: rgba(255,255,255,0.1);
            border-left-color: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px;
            font-family: var(--font-main);
            font-size: 1rem;
            font-weight: bold;
            color: #ccc;
            cursor: pointer;
            background: linear-gradient(145deg, var(--key-bg-light), var(--key-bg));
            box-shadow: 3px 3px 6px var(--key-shadow), -3px -3px 6px #5a5a5a;
            transition: all 0.1s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .mode-btn:active, .op-btn:active {
            background: var(--key-active-bg);
            box-shadow: inset 2px 2px 4px var(--key-shadow), inset -2px -2px 4px #5a5a5a;
            transform: translateY(1px);
            color: #fff;
        }

        .mode-btn.active {
            box-shadow: inset 3px 3px 6px var(--key-shadow), inset -3px -3px 6px #5a5a5a;
            background: #333;
            color: #00f5d4; /* A bright color for active state */
            text-shadow: 0 0 5px #00f5d4;
        }

        .op-symbol {
            font-size: 1.2rem;
        }

        .op-name {
            font-size: 0.7rem;
            text-transform: uppercase;
        }

        .bottom-row {
            align-items: center;
        }

        .bit-width-control {
            grid-column: 1 / span 2;
        }

        .help-button-container {
            grid-column: 5 / span 1;
        }

        .bit-width-control, .help-button-container {
             background: linear-gradient(145deg, var(--key-bg), var(--key-bg-light));
             border-radius: 8px;
             padding: 8px;
             box-shadow: inset 2px 2px 4px var(--key-shadow), inset -2px -2px 4px #5a5a5a;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 10px;
        }

        .bit-width-control label {
            font-weight: bold;
            color: #aaa;
        }

        #bit-width {
            width: 60px;
            background: #222;
            border: 1px solid #111;
            color: #eee;
            font-family: var(--font-main);
            font-size: 1.2rem;
            text-align: center;
            border-radius: 4px;
            padding: 2px;
        }

        .help-button-container {
            grid-column: 4;
            padding: 0;
        }

        .help-button-container details {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .help-button-container summary {
            list-style: none;
            cursor: pointer;
            border: 1px solid rgba(0,0,0,0.5);
            border-top-color: rgba(255,255,255,0.1);
            border-left-color: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px;
            font-size: 1rem;
            font-weight: bold;
            color: #ccc;
            background: linear-gradient(145deg, var(--key-bg-light), var(--key-bg));
            box-shadow: 3px 3px 6px var(--key-shadow), -3px -3px 6px #5a5a5a;
            transition: all 0.1s ease-out;
            text-align: center;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-button-container details[open] summary, .help-button-container summary:active {
            background: var(--key-active-bg);
            box-shadow: inset 2px 2px 4px var(--key-shadow), inset -2px -2px 4px #5a5a5a;
            transform: translateY(1px);
        }

        .help-content {
            position: absolute;
            bottom: calc(100% + 10px);
            right: 0;
            background: #222;
            border: 1px solid #555;
            border-radius: 6px;
            padding: 10px;
            width: 200px;
            z-index: 10;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
        }

        .help-content h3 {
            margin: 0 0 5px 0;
            color: #00f5d4;
        }

        .help-content ul {
            list-style-type: none;
            padding: 0;
        }

        .help-content li {
            margin-bottom: 3px;
        }

        #footer-branding {
            text-align: center;
            font-size: 0.7rem;
            color: #888;
        }

        #footer-branding a {
            color: #aaa;
            text-decoration: none;
        }

        #footer-branding a:hover {
            color: #fff;
        }

        /* --- Digit Keypad Styles --- */

        .keypad-digit-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        /* --- Explicit Grid Placement for Keys --- */

        /* 10-Key Pad (Cols 1-3) */
        .key-digit[data-key="7"] { grid-area: 1 / 1; }
        .key-digit[data-key="8"] { grid-area: 1 / 2; }
        .key-digit[data-key="9"] { grid-area: 1 / 3; }

        .key-digit[data-key="4"] { grid-area: 2 / 1; }
        .key-digit[data-key="5"] { grid-area: 2 / 2; }
        .key-digit[data-key="6"] { grid-area: 2 / 3; }

        .key-digit[data-key="1"] { grid-area: 3 / 1; }
        .key-digit[data-key="2"] { grid-area: 3 / 2; }
        .key-digit[data-key="3"] { grid-area: 3 / 3; }

        .key-digit[data-key="0"] {
            grid-area: 4 / 1 / 5 / 4; /* Span three columns */
        }

        /* Hex Keys (Col 4) */
        .key-hex[data-key="A"] { grid-area: 1 / 4; }
        .key-hex[data-key="B"] { grid-area: 2 / 4; }
        .key-hex[data-key="C"] { grid-area: 3 / 4; }
        .key-hex[data-key="D"] { grid-area: 4 / 4; }

        /* Function Keys & Hex Keys (Col 5) */
        #key-backspace { grid-area: 1 / 5; }
        #key-clear { grid-area: 2 / 5; }
        .key-hex[data-key="E"] { grid-area: 3 / 5; }
        .key-hex[data-key="F"] { grid-area: 4 / 5; }

        .key-digit, .key-hex, .key-func {
            border: 1px solid rgba(0,0,0,0.5);
            border-top-color: rgba(255,255,255,0.2);
            border-left-color: rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 12px 10px;
            font-family: var(--font-main);
            font-size: 1.2rem;
            font-weight: bold;
            color: #eee;
            cursor: pointer;
            transition: all 0.1s ease-out;
            background: linear-gradient(145deg, #585858, #4a4a4a);
            box-shadow: 3px 3px 6px var(--key-shadow), -3px -3px 6px #6a6a6a;
        }

        .key-digit:active, .key-hex:active, .key-func:active {
            box-shadow: inset 2px 2px 4px var(--key-shadow), inset -2px -2px 4px #6a6a6a;
            transform: translateY(1px);
        }

        .key-func {
            background: linear-gradient(145deg, #8a8a8a, #7a7a7a);
            color: #222;
        }

        .key-hex[disabled], .key-digit[disabled] {
            background: var(--key-bg);
            opacity: 0.3;
            cursor: not-allowed;
            box-shadow: inset 2px 2px 4px var(--key-shadow);
        }

    </style>
</head>
<body>

    <div id="calculator-body">
        <div id="brand-header">
            <h1>NUMCALC</h1>
            <svg id="lisp-logo" width="24" height="24" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><path fill="#805AD2" d="M64 0A64 64 0 1 0 64 0Zm0 128A64 64 0 1 0 64 128Z"></path><path fill="#2D3748" d="M64 0A64 64 0 0 0 64 128V64A32 32 0 0 1 64 0Z"></path><path fill="#EDF2F7" d="M64 128A64 64 0 0 0 64 0v64a32 32 0 0 1 0 64Z"></path></svg>
        </div>

        <div id="lcd-screen">
            <div id="main-display">
                <span class="input-mode">DEC></span>
                <input type="text" id="number-input" placeholder="Enter a number..." autocomplete="off">
            </div>

            <div class="representations">
                <div class="repr-item">
                    <label>DEC</label>
                    <span id="dec-value" class="value">0</span>
                    <button class="copy-btn" data-value="dec-value" title="Copy"><svg class="copy-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                </div>
                <div class="repr-item">
                    <label>HEX</label>
                    <span id="hex-value" class="value">0x00000000</span>
                    <button class="copy-btn" data-value="hex-value" title="Copy"><svg class="copy-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                </div>
                <div class="repr-item">
                    <label>OCT</label>
                    <span id="oct-value" class="value">0o00000000000</span>
                    <button class="copy-btn" data-value="oct-value" title="Copy"><svg class="copy-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                </div>
                <div class="repr-item">
                    <label>BIN</label>
                    <span id="bin-value" class="value binary">00000000000000000000000000000000</span>
                    <button class="copy-btn" data-value="bin-value" title="Copy"><svg class="copy-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                </div>
                 <div class="repr-item special-item">
                    <label>ENG</label>
                    <span id="english-value" class="value">zero</span>
                    <button class="copy-btn" data-value="english-value" title="Copy"><svg class="copy-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                </div>
                <div class="repr-item special-item">
                    <label>ROM</label>
                    <span id="roman-value" class="value">...</span>
                    <button class="copy-btn" data-value="roman-value" title="Copy"><svg class="copy-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                </div>
            </div>
        </div>

        <div id="keypad">
            <div class="keypad-row">
                <button id="mode-dec" class="mode-btn active" data-mode="dec">DEC</button>
                <button id="mode-hex" class="mode-btn" data-mode="hex">HEX</button>
                <button id="mode-oct" class="mode-btn" data-mode="oct">OCT</button>
                <button id="mode-bin" class="mode-btn" data-mode="bin">BIN</button>
            </div>
             <div class="keypad-row">
                 <button id="op-invert" class="op-btn">
                    <span class="op-symbol">~</span>
                    <span class="op-name">INV</span>
                </button>
                <button id="op-shift-left" class="op-btn">
                    <span class="op-symbol">&lt;&lt;</span>
                    <span class="op-name">LSH</span>
                </button>
                <button id="op-shift-right" class="op-btn">
                    <span class="op-symbol">&gt;&gt;</span>
                    <span class="op-name">RSH</span>
                </button>
                 <button id="op-reverse" class="op-btn">
                    <span class="op-symbol">⥁</span>
                    <span class="op-name">REV</span>
                </button>
                <div></div>
            </div>

            <div class="keypad-digit-grid">
                <!-- This container will be a 4x5 CSS Grid. Items are placed via CSS. -->
                <button class="key-hex" data-key="A">A</button>
                <button class="key-hex" data-key="B">B</button>
                <button class="key-hex" data-key="C">C</button>
                <button class="key-hex" data-key="D">D</button>
                <button class="key-hex" data-key="E">E</button>
                <button class="key-hex" data-key="F">F</button>

                <button class="key-digit" data-key="7">7</button>
                <button class="key-digit" data-key="8">8</button>
                <button class="key-digit" data-key="9">9</button>
                <button class="key-digit" data-key="4">4</button>
                <button class="key-digit" data-key="5">5</button>
                <button class="key-digit" data-key="6">6</button>
                <button class="key-digit" data-key="1">1</button>
                <button class="key-digit" data-key="2">2</button>
                <button class="key-digit" data-key="3">3</button>
                <button class="key-digit" data-key="0">0</button>

                <button id="key-clear" class="key-func">C</button>
                <button id="key-backspace" class="key-func">⌫</button>
            </div>

             <div class="keypad-row bottom-row">
                <div class="bit-width-control">
                    <label for="bit-width">BITS</label>
                    <input type="number" id="bit-width" value="32" min="1" step="1">
                </div>
                <div class="help-button-container">
                     <details>
                        <summary>?</summary>
                        <div class="help-content">
                            <h3>Shortcuts:</h3>
                            <ul>
                                <li><strong>D,H,O,B</strong> - mode</li>
                                <li><strong>I,L,R,V</strong> - ops</li>
                            </ul>
                        </div>
                    </details>
                </div>
            </div>
        </div>
         <div id="footer-branding">
            <p>JS conversion of <a href="https://github.com/jlowder/num" target="_blank" rel="noopener noreferrer">num</a></p>
        </div>
    </div>

    <script>
        /**
         * Core utilities for number conversion and bitwise operations
         * Port of num.lisp functionality to JavaScript with BigInt support
         */
        class NumberConverter {
            constructor(bitWidth = 32) {
                this.bitWidth = bitWidth;
            }

            /**
             * Convert BigInt to bit array (equivalent to integer->bit-vector in Lisp)
             */
            integerToBitArray(num) {
                const bigNum = BigInt(num);
                if (bigNum === 0n) return [0];
                
                const bits = [];
                let n = bigNum < 0n ? -bigNum : bigNum;
                while (n > 0n) {
                    bits.unshift(Number(n & 1n));
                    n = n >> 1n;
                }
                return bits;
            }

            /**
             * Convert bit array to BigInt (equivalent to bit-vector->integer in Lisp)
             */
            bitArrayToInteger(bits) {
                return bits.reduce((acc, bit) => acc * 2n + BigInt(bit), 0n);
            }

            /**
             * Pad bit array to specified width
             */
            padBitArray(bits, width) {
                const padding = width - bits.length;
                if (padding > 0) {
                    return new Array(padding).fill(0).concat(bits);
                }
                return bits.slice(-width); // Truncate if too long
            }

            /**
             * Format BigInt for display in different bases
             */
            formatNumber(num, base, bitWidth = this.bitWidth) {
                const bigNum = BigInt(num);
                switch (base) {
                    case 'dec':
                        return bigNum.toString(10);
                    case 'hex':
                        const hexDigits = Math.max(1, Math.ceil(bitWidth / 4));
                        return '0x' + bigNum.toString(16).toUpperCase().padStart(hexDigits, '0');
                    case 'bin':
                        return bigNum.toString(2).padStart(bitWidth, '0');
                    case 'oct':
                        const octDigits = Math.max(1, Math.ceil(bitWidth / 3));
                        return '0o' + bigNum.toString(8).padStart(octDigits, '0');
                    default:
                        throw new Error(`Unknown base: ${base}`);
                }
            }

            /**
             * Parse number from string with given radix, ignoring non-alphanumeric characters
             * Returns BigInt for arbitrary precision
             */
            parseNumber(str, radix = 10) {
                // Remove all non-alphanumeric characters (equivalent to regex-replace-all in Lisp)
                const cleaned = str.replace(/[^0-9a-fA-F]/g, '');
                if (cleaned === '') return 0n;

                try {
                    const prefix = {
                        16: '0x',
                        8: '0o',
                        2: '0b'
                    }[radix];
                    return BigInt(prefix ? prefix + cleaned : cleaned);
                } catch (error) {
                    return 0n;
                }
            }

            /**
             * Bitwise invert operation
             */
            invert(num) {
                const bits = this.padBitArray(this.integerToBitArray(num), this.bitWidth);
                const inverted = bits.map(bit => bit ^ 1);
                return this.bitArrayToInteger(inverted);
            }

            /**
             * Shift right operation
             */
            shiftRight(num) {
                const bits = this.padBitArray(this.integerToBitArray(num), this.bitWidth);
                const shifted = [0].concat(bits.slice(0, this.bitWidth - 1));
                return this.bitArrayToInteger(shifted);
            }

            /**
             * Shift left operation
             */
            shiftLeft(num) {
                const bits = this.padBitArray(this.integerToBitArray(num), this.bitWidth);
                const shifted = bits.slice(1).concat([0]);
                return this.bitArrayToInteger(shifted);
            }

            /**
             * Reverse bit order
             */
            reverseBits(num) {
                const bits = this.padBitArray(this.integerToBitArray(num), this.bitWidth);
                const reversed = bits.slice().reverse();
                return this.bitArrayToInteger(reversed);
            }

            /**
             * Convert BigInt to English words
             */
            numberToEnglish(num) {
                const bigNum = BigInt(num);
                if (bigNum === 0n) return 'zero';
                
                const ones = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
                const teens = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
                const tens = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
                const scales = ['', 'thousand', 'million', 'billion', 'trillion', 'quadrillion', 'quintillion', 'sextillion', 'septillion', 'octillion', 'nonillion', 'decillion'];
                
                function convertChunk(n) {
                    let result = '';
                    
                    if (n >= 100) {
                        result += ones[Math.floor(n / 100)] + ' hundred';
                        n %= 100;
                        if (n > 0) result += ' ';
                    }
                    
                    if (n >= 20) {
                        result += tens[Math.floor(n / 10)];
                        n %= 10;
                        if (n > 0) result += '-' + ones[n];
                    } else if (n >= 10) {
                        result += teens[n - 10];
                    } else if (n > 0) {
                        result += ones[n];
                    }
                    
                    return result;
                }
                
                if (bigNum < 0n) {
                    return 'negative ' + this.numberToEnglish(-bigNum);
                }
                
                // Handle very large numbers
                if (bigNum >= BigInt(10) ** BigInt(scales.length * 3)) {
                    return `${bigNum.toString()} (too large for word representation)`;
                }
                
                const chunks = [];
                let scaleIndex = 0;
                let workingNum = bigNum;
                
                while (workingNum > 0n) {
                    const chunk = Number(workingNum % 1000n);
                    if (chunk > 0) {
                        let chunkStr = convertChunk(chunk);
                        if (scaleIndex > 0 && scaleIndex < scales.length) {
                            chunkStr += ' ' + scales[scaleIndex];
                        }
                        chunks.unshift(chunkStr);
                    }
                    workingNum = workingNum / 1000n;
                    scaleIndex++;
                    
                    if (scaleIndex >= scales.length) {
                        // If we exceed our scale names, just return the numeric representation
                        return `${bigNum.toString()} (too large for word representation)`;
                    }
                }
                
                return chunks.join(' ');
            }

            /**
             * Convert BigInt to Roman numerals
             */
            numberToRoman(num) {
                const bigNum = BigInt(num);
                if (bigNum <= 0n || bigNum > 3999n) {
                    return 'Number out of range (1-3999)';
                }
                
                const values = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1];
                const numerals = ['M', 'CM', 'D', 'CD', 'C', 'XC', 'L', 'XL', 'X', 'IX', 'V', 'IV', 'I'];
                
                let result = '';
                let workingNum = Number(bigNum);
                for (let i = 0; i < values.length; i++) {
                    while (workingNum >= values[i]) {
                        result += numerals[i];
                        workingNum -= values[i];
                    }
                }
                return result;
            }

            /**
             * Get all representations of a number
             */
            getAllRepresentations(num) {
                return {
                    decimal: this.formatNumber(num, 'dec'),
                    hexadecimal: this.formatNumber(num, 'hex'),
                    binary: this.formatNumber(num, 'bin'),
                    octal: this.formatNumber(num, 'oct'),
                    english: this.numberToEnglish(num),
                    roman: this.numberToRoman(num)
                };
            }
        }

        /**
         * Client-side JavaScript for the Num web application
         * All functionality runs locally without server communication
         */
        class NumWebApp {
            constructor() {
                this.currentMode = 'dec';
                this.currentNumber = 0n;
                this.bitWidth = 32;
                this.converter = new NumberConverter(this.bitWidth);
                
                this.initializeElements();
                this.attachEventListeners();
                this.updateDisplay();
                this.updateModeUI(); // Initial UI setup
            }

            initializeElements() {
                // Mode buttons
                this.modeBtns = {
                    dec: document.getElementById('mode-dec'),
                    hex: document.getElementById('mode-hex'),
                    oct: document.getElementById('mode-oct'),
                    bin: document.getElementById('mode-bin')
                };

                // Input elements
                this.numberInput = document.getElementById('number-input');
                this.inputModeSpan = document.querySelector('.input-mode');
                this.bitWidthInput = document.getElementById('bit-width');

                // Display elements
                this.decValue = document.getElementById('dec-value');
                this.hexValue = document.getElementById('hex-value');
                this.octValue = document.getElementById('oct-value');
                this.binValue = document.getElementById('bin-value');
                this.englishValue = document.getElementById('english-value');
                this.romanValue = document.getElementById('roman-value');

                // Operation buttons
                this.opBtns = {
                    invert: document.getElementById('op-invert'),
                    shiftLeft: document.getElementById('op-shift-left'),
                    shiftRight: document.getElementById('op-shift-right'),
                    reverse: document.getElementById('op-reverse')
                };

                // Keypad buttons
                this.digitKeys = document.querySelectorAll('.key-digit, .key-hex');
                this.numericDigitKeys = document.querySelectorAll('.key-digit');
                this.hexKeys = document.querySelectorAll('.key-hex');
                this.clearKey = document.getElementById('key-clear');
                this.backspaceKey = document.getElementById('key-backspace');

                // Copy buttons
                this.copyBtns = document.querySelectorAll('.copy-btn');
            }

            attachEventListeners() {
                // Mode buttons
                Object.keys(this.modeBtns).forEach(mode => {
                    this.modeBtns[mode].addEventListener('click', () => this.setMode(mode));
                });

                // Number input
                this.numberInput.addEventListener('input', this.debounce(() => {
                    this.updateNumber(this.numberInput.value);
                }, 200));

                // Bit width input
                this.bitWidthInput.addEventListener('input', () => {
                    const width = parseInt(this.bitWidthInput.value);
                    if (width > 0 && width <= 256) { // Add a reasonable upper limit
                        this.setBitWidth(width);
                    } else if (this.bitWidthInput.value === '') {
                        this.setBitWidth(32); // Reset to default if empty
                    }
                });

                // Operation buttons
                this.opBtns.invert.addEventListener('click', () => this.performOperation('invert'));
                this.opBtns.shiftLeft.addEventListener('click', () => this.performOperation('shift-left'));
                this.opBtns.shiftRight.addEventListener('click', () => this.performOperation('shift-right'));
                this.opBtns.reverse.addEventListener('click', () => this.performOperation('reverse-bits'));

                // Keypad Listeners
                this.digitKeys.forEach(key => {
                    key.addEventListener('click', () => this._handleInput(key.dataset.key));
                });
                this.clearKey.addEventListener('click', () => this._handleClear());
                this.backspaceKey.addEventListener('click', () => this._handleBackspace());


                // Copy buttons
                this.copyBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const targetId = e.currentTarget.getAttribute('data-value');
                        const targetElement = document.getElementById(targetId);
                        this.copyToClipboard(targetElement.textContent, e.currentTarget);
                    });
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'DETAILS') return;
                    
                    const key = e.key.toLowerCase();
                    const validHex = 'abcdef';
                    const validDec = '0123456789';

                    if (validDec.includes(key) || (this.currentMode === 'hex' && validHex.includes(key))) {
                        e.preventDefault();
                        this._handleInput(key.toUpperCase());
                    } else if (key === 'backspace') {
                        e.preventDefault();
                        this._handleBackspace();
                    } else if (key === 'enter' || key === '=') {
                         e.preventDefault();
                        // Potentially useful for future expression evaluation
                    } else {
                        switch (key) {
                            case 'd': e.preventDefault(); this.setMode('dec'); break;
                            case 'h': e.preventDefault(); this.setMode('hex'); break;
                            case 'o': e.preventDefault(); this.setMode('oct'); break;
                            case 'b': e.preventDefault(); this.setMode('bin'); break;
                            case 'i': e.preventDefault(); this.performOperation('invert'); break;
                            case 'l': e.preventDefault(); this.performOperation('shift-left'); break;
                            case 'r': e.preventDefault(); this.performOperation('shift-right'); break;
                            case 'v': e.preventDefault(); this.performOperation('reverse-bits'); break;
                        }
                    }
                });
            }

            _handleInput(key) {
                // Prevent leading zeros if input is empty
                if (this.numberInput.value === '0') {
                    this.numberInput.value = '';
                }
                this.numberInput.value += key;
                // Manually trigger input event to update calculations
                this.numberInput.dispatchEvent(new Event('input'));
            }

            _handleClear() {
                this.numberInput.value = '';
                this.numberInput.dispatchEvent(new Event('input'));
            }

            _handleBackspace() {
                this.numberInput.value = this.numberInput.value.slice(0, -1);
                this.numberInput.dispatchEvent(new Event('input'));
            }

            setMode(mode) {
                this.currentMode = mode;
                this.updateModeUI();
            }

            updateNumber(value) {
                if (!value.trim()) {
                    this.currentNumber = 0n;
                    this.updateDisplay();
                    return;
                }

                try {
                    let radix;
                    switch (this.currentMode) {
                        case 'dec': radix = 10; break;
                        case 'hex': radix = 16; break;
                        case 'bin': radix = 2; break;
                        case 'oct': radix = 8; break;
                        default: radix = 10;
                    }
                    
                    this.currentNumber = this.converter.parseNumber(value.toString(), radix);
                    this.updateDisplay();
                } catch (error) {
                    console.error('Failed to update number:', error);
                }
            }

            setBitWidth(width) {
                if (width > 0) {
                    this.bitWidth = width;
                    this.converter = new NumberConverter(width);
                    this.updateDisplay();
                }
            }

            performOperation(operation) {
                try {
                    switch (operation) {
                        case 'invert':
                            this.currentNumber = this.converter.invert(this.currentNumber);
                            break;
                        case 'shift-left':
                            this.currentNumber = this.converter.shiftLeft(this.currentNumber);
                            break;
                        case 'shift-right':
                            this.currentNumber = this.converter.shiftRight(this.currentNumber);
                            break;
                        case 'reverse-bits':
                            this.currentNumber = this.converter.reverseBits(this.currentNumber);
                            break;
                    }
                    
                    this.updateDisplay();
                    // Update input to show the result in the current mode
                    this.numberInput.value = this.converter.formatNumber(this.currentNumber, this.currentMode).replace(/0x|0o/,'');
                } catch (error) {
                    console.error(`Failed to perform ${operation}:`, error);
                }
            }

            updateDisplay() {
                const representations = this.converter.getAllRepresentations(this.currentNumber);
                
                this.decValue.textContent = representations.decimal;
                this.hexValue.textContent = representations.hexadecimal;
                this.octValue.textContent = representations.octal;
                this.binValue.textContent = this.formatBinaryForDisplay(representations.binary);
                this.englishValue.textContent = representations.english;
                this.romanValue.textContent = representations.roman;
            }

            updateModeUI() {
                // Update active mode button
                Object.keys(this.modeBtns).forEach(mode => {
                    this.modeBtns[mode].classList.toggle('active', mode === this.currentMode);
                });

                // Update input mode indicator
                const modeNames = { dec: 'DEC', hex: 'HEX', oct: 'OCT', bin: 'BIN' };
                this.inputModeSpan.textContent = `${modeNames[this.currentMode]}>`;

                // Update input placeholder
                const placeholders = {
                    dec: 'Enter decimal...',
                    hex: 'Enter hexadecimal...',
                    oct: 'Enter octal...',
                    bin: 'Enter binary...'
                };
                this.numberInput.placeholder = placeholders[this.currentMode];

                // Update input field to reflect current number in new mode
                if (this.numberInput.value.trim() !== '') {
                    this.numberInput.value = this.converter.formatNumber(this.currentNumber, this.currentMode).replace(/0[xob]/, '');
                }

                // Enable/disable hex keys based on mode
                this.hexKeys.forEach(key => {
                    key.disabled = this.currentMode !== 'hex';
                });

                // Enable/disable numeric keys based on mode
                this.numericDigitKeys.forEach(key => {
                    const keyValue = parseInt(key.dataset.key, 10);
                    let disabled = false;
                    switch (this.currentMode) {
                        case 'oct':
                            if (keyValue >= 8) disabled = true;
                            break;
                        case 'bin':
                            if (keyValue >= 2) disabled = true;
                            break;
                    }
                    key.disabled = disabled;
                });

                // Clear input if it contains invalid characters for the new mode
                const validChars = {
                    dec: /[^0-9]/g,
                    hex: /[^0-9a-fA-F]/gi,
                    oct: /[^0-7]/g,
                    bin: /[^01]/g
                };
                if (this.numberInput.value.match(validChars[this.currentMode])) {
                    this._handleClear();
                }
            }

            formatBinaryForDisplay(binary) {
                // Add spaces every 4 bits for readability
                return binary.replace(/(.{4})/g, '$1 ').trim();
            }

            async copyToClipboard(text, button) {
                const copyIconHTML = button.innerHTML;
                const checkIconHTML = '<svg class="copy-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';

                try {
                    await navigator.clipboard.writeText(text);
                    
                    // Visual feedback
                    button.classList.add('copy-success');
                    button.innerHTML = checkIconHTML;
                    
                    setTimeout(() => {
                        button.classList.remove('copy-success');
                        button.innerHTML = copyIconHTML;
                    }, 1000);
                } catch (error) {
                    console.error('Failed to copy to clipboard:', error);
                }
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
        }

        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new NumWebApp();
        });
    </script>
</body>
</html>
